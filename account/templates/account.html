{% extends "base.html" %}
{% if messages %}
  <ul class="messages">
    {% for message in messages %}
      <li class="alert alert-{{ message.tags }}">{{ message }}</li>
    {% endfor %}
  </ul>
{% endif %}
{% block content %}
<div class='w-100 min-vh-100 d-flex flex-column justify-content-center align-items-center'>
    <div class='w-75 min-vh-100 d-flex flex-column justify-content-center align-items-center'>
        <div class='account-sec w-100 d-flex flex-column justify-content-center align-items-center'>
            <div class='position-relative w-100'>
                <div class='login w-100 d-flex flex-column justify-content-center align-items-center position-absolute top-50 start-50 translate-middle'>
                    <div class='fw-bolder fs-2 main-heading text-center'>Welcome Back</div>
                    <p class="text-break text-center">
                        Welcome Back, Please enter Your details.
                    </p>
                    <div class='w-50 d-flex flex-row justify-content-between align-items-center p-2 bg-light rounded-4'>
                        <button type="submit" class="login-btn btn btn-primary rounded-3 w-50 me-1 bg-white text-dark border-0 fs-5 fw-bold">Sign In</button>
                        <button type="submit" class="register-btn btn btn-primary rounded-3 w-50 ms-1 bg-transparent text-dark border-0 fs-5 fw-bold">Sign Up</button>
                    </div>
                    <div class='d-flex flex-column justify-content-center align-items-center bg-light m-3 p-4 ps-3 pe-3 rounded-4 border border-1'>
                        <form method="POST" action="{% url 'login_user' %}" class='w-100 d-flex flex-column justify-content-center align-items-center'>
                        {% csrf_token %}
                        <div class='d-flex flex-row justify-content-between'>
                            <div class="input-group w-50 p-1 ms-1 me-1">
                                <span class="input-group-text form-img form-sec-01 form-sec-02" style="border-radius: 12px 0 0 12px; border: 1.2px solid rgba(0, 0, 0, 0.5); border-right: none !important">
                                  <img src="/static/images/icons/email.svg" alt="Email Address" class='rounded'/>
                                </span>
                                <input type="email" name='email' class="form-control form-sec-01 form-sec-02 fs-5" style="border-radius: 0 12px 12px 0; border: 1.2px solid rgba(0, 0, 0, 0.5); border-left: none !important" placeholder="Email Address">
                            </div>
                            <div class="input-group w-50 p-1 ms-1 me-1">
                                <span class="input-group-text form-img form-sec-01 form-sec-02" style="border-radius: 12px 0 0 12px; border: 1.2px solid rgba(0, 0, 0, 0.5); border-right: none !important">
                                    <img src="/static/images/icons/password.svg" alt="Password" class='rounded'/>
                                </span>
                                <input type="password" name='password' id="passwordField" class="form-control form-sec-01 form-sec-02 fs-5" style="border-radius: 0; border: 1.2px solid rgba(0, 0, 0, 0.5); border-left: none !important" placeholder="Your Password">
                                <span class="input-group-text" style="border-radius: 0 12px 12px 0; border: 1.2px solid rgba(0, 0, 0, 0.5); border-left: none !important; cursor: pointer;" id="togglePassword">
                                    <i class="bi bi-eye-slash" id="toggleIcon"></i>
                                </span>
                            </div>
                        </div>   
                        <button type="submit" class='btn btn-link mt-3 w-75 text-center text-decoration-none align-items-center justify-content-center d-flex rounded-4 fw-bold pt-2 pb-2  button2 text-dark border-2 fs-6'>
                            Sign In
                        </button>   
                        </form>
                        <div class="w-100 d-flex align-items-center m-4">
                          <div class="w-50 divider-line rounded-pill"></div>
                          <span class="w-75 px-3 text-center">Or Continue With</span>
                          <div class="w-50 divider-line rounded-pill"></div>
                        </div>
                        <div class='d-flex flex-row justify-content-evenly align-items-center w-50 sec-sec-sec'>
                            <a href="{% url 'google_login' %}" class="rounded-circle"><img src="/static/images/icons/google.svg" alt="google" class='bg-light rounded-circle border border-1 border-gray'/></a>
                            <a class="rounded-circle"><img src="/static/images/icons/call.svg" alt="call" class='bg-light rounded-circle border border-1 border-gray'/></a>
                        </div>
                    </div>
                </div>
                <div class='register w-100 d-flex flex-column justify-content-center align-items-center position-absolute top-50 start-50 translate-middle' style="visibility: hidden;">
                    <div class='fw-bolder fs-2 main-heading text-center'>Welcome to TCI USA Visa</div>
                    <p class="text-break text-center">
                        Welcome, Please enter Your details.
                    </p>
                    <div class='w-50 d-flex flex-row justify-content-between align-items-center p-2 bg-light rounded-4'>
                        <button type="submit" class="login-btn btn btn-primary rounded-3 w-50 ms-1 bg-transparent text-dark border-0 fs-5 fw-bold">Sign In</button>
                        <button type="submit" class="register-btn btn btn-primary rounded-3 w-50 me-1 bg-white text-dark border-0 fs-5 fw-bold">Sign Up</button>
                    </div>
                    <div class='d-flex flex-column justify-content-center align-items-center bg-light m-3 p-4 ps-3 pe-3 rounded-4 border border-1'>
                        <form method="POST" action="{% url 'register_user' %}" class='d-flex flex-column justify-content-center align-items-center'>
                        {% csrf_token %}
                        <div class='d-flex flex-row justify-content-between'>
                            <div class="input-group w-50 p-1 ms-1 me-1 mb-1">
                                <span class="input-group-text form-img form-sec-01 form-sec-02" style="border-radius: 12px 0 0 12px; border: 1.2px solid rgba(0, 0, 0, 0.5); border-right: none !important">
                                  <img src="/static/images/icons/account.svg" alt="Email Address" class='rounded'/>
                                </span>
                                <input type="text" name='full-name' class="form-control form-sec-01 form-sec-02 fs-5" style="border-radius: 0 12px 12px 0; border: 1.2px solid rgba(0, 0, 0, 0.5); border-left: none !important" id="full-name" placeholder="Full Name">
                            </div>
                            <div class="input-group w-50 p-1 ms-1 me-1 mb-1">
                                <span class="input-group-text form-img form-sec-01 form-sec-02" style="border-radius: 12px 0 0 12px; border: 1.2px solid rgba(0, 0, 0, 0.5); border-right: none !important">
                                  <img src="/static/images/icons/account.svg" alt="Email Address" class='rounded'/>
                                </span>
                                <input type="text" name='username' class="form-control form-sec-01 form-sec-02 fs-5" style="border-radius: 0 12px 12px 0; border: 1.2px solid rgba(0, 0, 0, 0.5); border-left: none !important" id="username" placeholder="Username">
                            </div>
                        </div>   
                        <div class='d-flex flex-column w-100'>
                            <div class="input-group w-100 p-1 ms-1 mt-2">
                                <span class="input-group-text form-img form-sec-01 form-sec-02" style="border-radius: 12px 0 0 12px; border: 1.2px solid rgba(0, 0, 0, 0.5); border-right: none !important">
                                  <img src="/static/images/icons/email.svg" alt="Email Address" class='rounded'/>
                                </span>
                                <input type="email" name='email' class="me-2 form-control form-sec-01 form-sec-02 fs-5" style="border-radius: 0 12px 12px 0; border: 1.2px solid rgba(0, 0, 0, 0.5); border-left: none !important" id="email" placeholder="Email Address">
                            </div>
                            <div class="input-group w-100 p-1 ms-1 mt-3">
                                <span class="input-group-text form-img form-sec-01 form-sec-02" style="border-radius: 12px 0 0 12px; border: 1.2px solid rgba(0, 0, 0, 0.5); border-right: none !important">
                                  <img src="/static/images/icons/password.svg" alt="Password" class='rounded'/>
                                </span>
                                <input type="password" name='password' class="me-2 form-control form-sec-01 form-sec-02 fs-5" style="border-radius: 0 12px 12px 0; border: 1.2px solid rgba(0, 0, 0, 0.5); border-left: none !important" id="password" placeholder="Your Password">
                            </div>
                            
                        </div>   
                        <button type="submit" class='btn btn-link mt-3 w-75 text-center text-decoration-none align-items-center justify-content-center d-flex rounded-4 fw-bold pt-2 pb-2  button2 text-dark border-2 fs-6'>
                            Sign Up
                        </button>   
                        </form>
                        <div class="w-100 d-flex align-items-center m-4">
                          <div class="w-50 divider-line rounded-pill"></div>
                          <span class="w-75 px-3 text-center">Or Continue With</span>
                          <div class="w-50 divider-line rounded-pill"></div>
                        </div>
                        <div class='d-flex flex-row justify-content-evenly align-items-center w-50 sec-sec-sec'>
                            <a href="{% url 'google_login' %}" class="rounded-circle"><img src="/static/images/icons/google.svg" alt="google" class='bg-light rounded-circle border border-1 border-gray'/></a>
                            <a class="rounded-circle"><img src="/static/images/icons/call.svg" alt="call" class='bg-light rounded-circle border border-1 border-gray'/></a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Modal -->
<div class="modal fade" id="popupModal" tabindex="-1" aria-labelledby="popupModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="popupModalLabel">Notice</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body" id="popupMessage">
        <!-- Message inserted via JS -->
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" id="popupOkBtn" data-bs-dismiss="modal">OK</button>
      </div>
    </div>
  </div>
</div>
{% if messages %}
    {% for message in messages %}
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            alert('{{ message }}');
        });
    </script>
    {% endfor %}
{% endif %}
{% if login_status == 'invalid' %}
<script>
  const query = new URLSearchParams(window.location.search);
  const status = query.get('status');
  const login_status = query.get('login_status');

  if (status === 'invalid_username') {
    showPopup("Spaces are not allowed in the username. Please try again.");
  } else if (status === 'exists') {
    showPopup("The email or username already exists. Please try to log in.");
  } else if (status === 'success') {
    showPopup("Sign Up Completed!", () => {
      window.location.href = "/dashboard/";
    });
  }

  if (login_status === 'invalid') {
    showPopup("Incorrect Login ID / Password. Please Try Again.");
  }

  function showPopup(message, callback) {
    const popupModal = new bootstrap.Modal(document.getElementById('popupModal'));
    document.getElementById('popupMessage').innerText = message;
    document.getElementById('popupOkBtn').onclick = () => {
      if (callback) callback();
    };
    popupModal.show();
  }
</script>
{% endif %}
{% endblock %}